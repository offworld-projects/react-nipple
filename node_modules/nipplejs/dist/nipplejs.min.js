!function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).nipplejs=t()}}(function(){var o,t=!!("ontouchstart"in window),e=!!window.PointerEvent,i=!!window.MSPointerEvent,n={start:"mousedown",move:"mousemove",end:"mouseup"},r={};e?o={start:"pointerdown",move:"pointermove",end:"pointerup, pointercancel"}:i?o={start:"MSPointerDown",move:"MSPointerMove",end:"MSPointerUp"}:t?(o={start:"touchstart",move:"touchmove",end:"touchend, touchcancel"},r=n):o=n;var h={};function s(){}function p(t,e){return this.identifier=e.identifier,this.position=e.position,this.frontPosition=e.frontPosition,this.collection=t,this.frontImg=e.frontImg,this.backImg=e.backImg,this.upImg=e.upImg,this.downImg=e.downImg,this.leftImg=e.leftImg,this.rightImg=e.rightImg,this.maxMove=e.maxMove,this.frontSize=e.frontSize,this.defaults={size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,mode:"dynamic",zone:document.body,lockX:!1,lockY:!1,frontSize:50},this.config(e),"dynamic"===this.options.mode&&(this.options.restOpacity=0),this.id=p.id,p.id+=1,this.buildEl().stylize(),this.instance={el:this.ui.el,on:this.on.bind(this),off:this.off.bind(this),show:this.show.bind(this),hide:this.hide.bind(this),add:this.addToDom.bind(this),remove:this.removeFromDom.bind(this),destroy:this.destroy.bind(this),resetDirection:this.resetDirection.bind(this),computeDirection:this.computeDirection.bind(this),trigger:this.trigger.bind(this),position:this.position,frontPosition:this.frontPosition,ui:this.ui,identifier:this.identifier,id:this.id,options:this.options},this.instance}function d(t,e){var i=this;return i.nipples=[],i.idles=[],i.actives=[],i.ids=[],i.pressureIntervals={},i.manager=t,i.id=d.id,d.id+=1,i.defaults={zone:document.body,multitouch:!1,maxNumberOfNipples:10,mode:"dynamic",position:{top:0,left:0},catchDistance:200,size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,lockX:!1,lockY:!1,limitIn:!1,directionActive:!1,centerRest:0,frontImg:"",backImg:"",upImg:"",leftImg:"",rightImg:"",downImg:"",maxMove:0,frontSize:0},i.config(e),"static"!==i.options.mode&&"semi"!==i.options.mode||(i.options.multitouch=!1),i.options.multitouch||(i.options.maxNumberOfNipples=1),i.updateBox(),i.prepareNipples(),i.bindings(),i.begin(),i.nipples}function a(t){var e,o=this;return o.ids={},o.index=0,o.collections=[],o.config(t),o.prepareCollections(),h.bindEvt(window,"resize",function(t){clearTimeout(e),e=setTimeout(function(){var e,i=h.getScroll();o.collections.forEach(function(t){t.forEach(function(t){e=t.el.getBoundingClientRect(),t.position={x:i.x+e.left,y:i.y+e.top}})})},100)}),o.collections}h.distance=function(t,e){var i=e.x-t.x,o=e.y-t.y;return Math.sqrt(i*i+o*o)},h.angle=function(t,e){var i=e.x-t.x,o=e.y-t.y;return h.degrees(Math.atan2(o,i))},h.findCoord=function(t,e,i){var o={x:0,y:0};return i=h.radians(i),o.x=t.x-e*Math.cos(i),o.y=t.y-e*Math.sin(i),o},h.radians=function(t){return t*(Math.PI/180)},h.degrees=function(t){return t*(180/Math.PI)},h.bindEvt=function(t,e,i){for(var o,n=e.split(/[ ,]+/g),r=0;r<n.length;r+=1)o=n[r],t.addEventListener?t.addEventListener(o,i,!1):t.attachEvent&&t.attachEvent(o,i)},h.unbindEvt=function(t,e,i){for(var o,n=e.split(/[ ,]+/g),r=0;r<n.length;r+=1)o=n[r],t.removeEventListener?t.removeEventListener(o,i):t.detachEvent&&t.detachEvent(o,i)},h.trigger=function(t,e,i){var o=new CustomEvent(e,i);t.dispatchEvent(o)},h.prepareEvent=function(t){return t.preventDefault(),t.type.match(/^touch/)?t.changedTouches:t},h.getScroll=function(){return{x:void 0!==window.pageXOffset?window.pageXOffset:(document.documentElement||document.body.parentNode||document.body).scrollLeft,y:void 0!==window.pageYOffset?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop}},h.applyPosition=function(t,e){e.top||e.right||e.bottom||e.left?(t.style.top=e.top,t.style.right=e.right,t.style.bottom=e.bottom,t.style.left=e.left):(t.style.left=e.x+"px",t.style.top=e.y+"px")},h.getTransitionStyle=function(t,e,i){var o=h.configStylePropertyObject(t);for(var n in o)if(o.hasOwnProperty(n))if("string"==typeof e)o[n]=e+" "+i;else{for(var r="",s=0,d=e.length;s<d;s+=1)r+=e[s]+" "+i+", ";o[n]=r.slice(0,-2)}return o},h.getVendorStyle=function(t,e){var i=h.configStylePropertyObject(t);for(var o in i)i.hasOwnProperty(o)&&(i[o]=e);return i},h.configStylePropertyObject=function(e){var i={};i[e]="";return["webkit","Moz","o"].forEach(function(t){i[t+e.charAt(0).toUpperCase()+e.slice(1)]=""}),i},h.extend=function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);return t},h.safeExtend=function(t,e){var i={};for(var o in t)t.hasOwnProperty(o)&&e.hasOwnProperty(o)?i[o]=e[o]:t.hasOwnProperty(o)&&(i[o]=t[o]);return i},h.map=function(t,e){if(t.length)for(var i=0,o=t.length;i<o;i+=1)e(t[i]);else e(t)},h.applyImageStyle=function(t,e){t.style.background=e,t.style.backgroundSize="100% 100%",t.style.backgroundRepeat="no-repeat"},s.prototype.on=function(t,e){var i,o=this,n=t.split(/[ ,]+/g);o._handlers_=o._handlers_||{};for(var r=0;r<n.length;r+=1)i=n[r],o._handlers_[i]=o._handlers_[i]||[],o._handlers_[i].push(e);return o},s.prototype.off=function(t,e){var i=this;return i._handlers_=i._handlers_||{},void 0===t?i._handlers_={}:void 0===e?i._handlers_[t]=null:i._handlers_[t]&&0<=i._handlers_[t].indexOf(e)&&i._handlers_[t].splice(i._handlers_[t].indexOf(e),1),i},s.prototype.trigger=function(t,e){var i,o=this,n=t.split(/[ ,]+/g);o._handlers_=o._handlers_||{};for(var r=0;r<n.length;r+=1)i=n[r],o._handlers_[i]&&o._handlers_[i].length&&o._handlers_[i].forEach(function(t){t.call(o,{type:i,target:o},e)})},s.prototype.config=function(t){this.options=this.defaults||{},t&&(this.options=h.safeExtend(this.options,t))},s.prototype.bindEvt=function(t,e){var i=this;return i._domHandlers_=i._domHandlers_||{},i._domHandlers_[e]=function(){"function"==typeof i["on"+e]?i["on"+e].apply(i,arguments):console.warn('[WARNING] : Missing "on'+e+'" handler.')},h.bindEvt(t,o[e],i._domHandlers_[e]),r[e]&&h.bindEvt(t,r[e],i._domHandlers_[e]),i},s.prototype.unbindEvt=function(t,e){var i=this;return i._domHandlers_=i._domHandlers_||{},h.unbindEvt(t,o[e],i._domHandlers_[e]),r[e]&&h.unbindEvt(t,r[e],i._domHandlers_[e]),delete i._domHandlers_[e],this},p.prototype=new s,(p.constructor=p).id=0,p.prototype.buildEl=function(t){return this.ui={},this.options.dataOnly||(this.ui.el=document.createElement("div"),this.ui.back=document.createElement("div"),this.ui.front=document.createElement("div"),this.ui.el.className="nipple collection_"+this.collection.id,this.ui.back.className="back",this.ui.front.className="front",this.ui.el.setAttribute("id","nipple_"+this.collection.id+"_"+this.id),this.ui.el.appendChild(this.ui.back),this.ui.el.appendChild(this.ui.front)),this},p.prototype.stylize=function(){if(this.options.dataOnly)return this;var t=this.options.fadeTime+"ms",e=h.getVendorStyle("borderRadius","50%"),i=h.getTransitionStyle("transition","opacity",t),o={};o.el={position:"absolute",opacity:this.options.restOpacity,display:"block",zIndex:999},o.back={position:"absolute",display:"block",width:this.options.size+"px",height:this.options.size+"px",marginLeft:-this.options.size/2+"px",marginTop:-this.options.size/2+"px",background:this.backImg||this.options.color,backgroundSize:"100% 100%"};var n=-this.options.size/4,r=-this.options.size/4,s=this.options.size/2,d=this.options.size/2;return 0!=this.options.frontSize&&(n=-this.options.frontSize/2,r=-this.options.frontSize/2,s=this.options.frontSize,d=this.options.frontSize),o.front={width:s+"px",height:d+"px",position:"absolute",display:"block",marginLeft:n+"px",marginTop:r+"px",background:this.frontImg||this.options.color,backgroundSize:"contain"},h.extend(o.el,i),h.extend(o.back,e),h.extend(o.front,e),this.applyStyles(o),this},p.prototype.applyStyles=function(t){for(var e in this.ui)if(this.ui.hasOwnProperty(e))for(var i in t[e])this.ui[e].style[i]=t[e][i];return this},p.prototype.addToDom=function(){return this.options.dataOnly||document.body.contains(this.ui.el)||this.options.zone.appendChild(this.ui.el),this},p.prototype.removeFromDom=function(){return this.options.dataOnly||!document.body.contains(this.ui.el)||this.options.zone.removeChild(this.ui.el),this},p.prototype.destroy=function(){clearTimeout(this.removeTimeout),clearTimeout(this.showTimeout),clearTimeout(this.restTimeout),this.trigger("destroyed",this.instance),this.removeFromDom(),this.off()},p.prototype.show=function(t){var e=this;return e.options.dataOnly||(clearTimeout(e.removeTimeout),clearTimeout(e.showTimeout),clearTimeout(e.restTimeout),e.addToDom(),e.restCallback(),setTimeout(function(){e.ui.el.style.opacity=1},0),e.showTimeout=setTimeout(function(){e.trigger("shown",e.instance),"function"==typeof t&&t.call(this)},e.options.fadeTime)),e},p.prototype.hide=function(e){var i=this;return i.options.dataOnly||(i.ui.el.style.opacity=i.options.restOpacity,h.applyImageStyle(i.ui.front,i.frontImg||i.color),clearTimeout(i.removeTimeout),clearTimeout(i.showTimeout),clearTimeout(i.restTimeout),i.removeTimeout=setTimeout(function(){var t="dynamic"===i.options.mode?"none":"block";i.ui.el.style.display=t,"function"==typeof e&&e.call(i),i.trigger("hidden",i.instance)},i.options.fadeTime),i.options.restJoystick&&i.restPosition()),i},p.prototype.restPosition=function(t){var e=this;e.frontPosition={x:0,y:0};var i=e.options.fadeTime+"ms",o={};o.front=h.getTransitionStyle("transition",["top","left"],i);var n={front:{}};n.front={left:e.frontPosition.x+"px",top:e.frontPosition.y+"px"},e.applyStyles(o),e.applyStyles(n),e.restTimeout=setTimeout(function(){"function"==typeof t&&t.call(e),e.restCallback()},e.options.fadeTime)},p.prototype.restCallback=function(){var t={};t.front=h.getTransitionStyle("transition","none",""),this.applyStyles(t),this.trigger("rested",this.instance)},p.prototype.resetDirection=function(){this.direction={x:!1,y:!1,angle:!1}},p.prototype.computeDirection=function(t){var e,i,o,n=t.angle.radian,r=Math.PI/4,s=Math.PI/2;if(r<n&&n<3*r&&!t.lockX?e="up":-r<n&&n<=r&&!t.lockY?e="left":3*-r<n&&n<=-r&&!t.lockX?e="down":t.lockY||(e="right"),t.lockY||(i=-s<n&&n<s?"left":"right"),t.lockX||(o=0<n?"up":"down"),t.force>this.options.threshold){var d={};for(var a in this.direction)this.direction.hasOwnProperty(a)&&(d[a]=this.direction[a]);var p={};for(var a in this.direction={x:i,y:o,angle:e},t.direction=this.direction,d)d[a]===this.direction[a]&&(p[a]=!0);if(p.x&&p.y&&p.angle)return t;p.x&&p.y||this.trigger("plain",t),p.x||this.trigger("plain:"+i,t),p.y||this.trigger("plain:"+o,t),p.angle||this.trigger("dir dir:"+e,t)}return t},d.prototype=new s,(d.constructor=d).id=0,d.prototype.prepareNipples=function(){var t=this,o=t.nipples;o.on=t.on.bind(t),o.off=t.off.bind(t),o.options=t.options,o.destroy=t.destroy.bind(t),o.ids=t.ids,o.id=t.id,o.processOnMove=t.processOnMove.bind(t),o.processOnEnd=t.processOnEnd.bind(t),o.get=function(t){if(void 0===t)return o[0];for(var e=0,i=o.length;e<i;e+=1)if(o[e].identifier===t)return o[e];return!1}},d.prototype.bindings=function(){this.bindEvt(this.options.zone,"start"),this.options.zone.style.touchAction="none",this.options.zone.style.msTouchAction="none"},d.prototype.begin=function(){var t=this.options;if("static"===t.mode){var e=this.createNipple(t.position,this.manager.getIdentifier());e.add(),this.idles.push(e)}},d.prototype.createNipple=function(t,e){var i=this,o=h.getScroll(),n={},r=i.options;if(t.x&&t.y)n={x:t.x-(o.x+i.box.left),y:t.y-(o.y+i.box.top)};else if(t.top||t.right||t.bottom||t.left){var s=document.createElement("DIV");s.style.display="hidden",s.style.top=t.top,s.style.right=t.right,s.style.bottom=t.bottom,s.style.left=t.left,s.style.position="absolute",r.zone.appendChild(s);var d=s.getBoundingClientRect();r.zone.removeChild(s),n=t,t={x:d.left+o.x,y:d.top+o.y}}var a=new p(i,{color:r.color,size:r.size,threshold:r.threshold,fadeTime:r.fadeTime,dataOnly:r.dataOnly,restJoystick:r.restJoystick,restOpacity:r.restOpacity,mode:r.mode,identifier:e,position:t,zone:r.zone,frontPosition:{x:0,y:0},frontImg:r.frontImg,backImg:r.backImg,upImg:r.upImg,downImg:r.downImg,leftImg:r.leftImg,rightImg:r.rightImg,maxMove:r.maxMove,frontSize:r.frontSize});return r.dataOnly||(h.applyPosition(a.ui.el,n),h.applyPosition(a.ui.front,a.frontPosition)),i.nipples.push(a),i.trigger("added "+a.identifier+":added",a),i.manager.trigger("added "+a.identifier+":added",a),i.bindNipple(a),a},d.prototype.updateBox=function(){this.box=this.options.zone.getBoundingClientRect()},d.prototype.bindNipple=function(t){var i,o=this,e=function(t,e){i=t.type+" "+e.id+":"+t.type,o.trigger(i,e)};t.on("destroyed",o.onDestroyed.bind(o)),t.on("shown hidden rested dir plain",e),t.on("dir:up dir:right dir:down dir:left",e),t.on("plain:up plain:right plain:down plain:left",e)},d.prototype.pressureFn=function(e,i,t){var o=this,n=0;clearInterval(o.pressureIntervals[t]),o.pressureIntervals[t]=setInterval(function(){var t=e.force||e.pressure||e.webkitForce||0;t!==n&&(i.trigger("pressure",t),o.trigger("pressure "+i.identifier+":pressure",t),n=t)}.bind(o),100)},d.prototype.onstart=function(t){var e=this,i=e.options;t=h.prepareEvent(t),e.updateBox();return h.map(t,function(t){e.actives.length<i.maxNumberOfNipples&&e.processOnStart(t)}),e.manager.bindDocument(),!1},d.prototype.processOnStart=function(e){var t,i=this,o=i.options,n=i.manager.getIdentifier(e),r=e.force||e.pressure||e.webkitForce||0,s={x:e.pageX,y:e.pageY},d=i.getOrCreate(n,s);d.identifier!==n&&i.manager.removeIdentifier(d.identifier),d.identifier=n;var a=function(t){t.trigger("start",t),i.trigger("start "+t.id+":start",t),t.show(),0<r&&i.pressureFn(e,t,t.identifier),i.processOnMove(e)};if(0<=(t=i.idles.indexOf(d))&&i.idles.splice(t,1),i.actives.push(d),i.ids.push(d.identifier),"semi"!==o.mode)a(d);else{if(!(h.distance(s,d.position)<=o.catchDistance))return d.destroy(),void i.processOnStart(e);a(d)}return d},d.prototype.getOrCreate=function(t,e){var i,o=this,n=o.options;return/(semi|static)/.test(n.mode)?(i=o.idles[0])?(o.idles.splice(0,1),i):"semi"===n.mode?o.createNipple(e,t):(console.warn("Coudln't find the needed nipple."),!1):i=o.createNipple(e,t)},d.prototype.processOnMove=function(t){var e=this,i=e.options,o=e.manager.getIdentifier(t),n=e.nipples.get(o);if(!n)return console.error("Found zombie joystick with ID "+o),void e.manager.removeIdentifier(o);n.identifier=o;var r=n.options.size/4;0!=i.maxMove&&(r=i.maxMove);var s={x:t.pageX,y:t.pageY},d=h.distance(s,n.position),a=h.angle(s,n.position),p=h.radians(a),l=d/r;r<d&&(d=r,s=h.findCoord(n.position,d,a));var c=s.x-n.position.x,f=s.y-n.position.y;i.lockX&&(f=0),i.lockY&&(c=0),n.frontPosition={x:c,y:f},i.dataOnly||(h.applyPosition(n.ui.front,n.frontPosition),0!=f&&0!=c?h.applyImageStyle(n.ui.front,i.frontImg||i.color):0!=c?c<0?h.applyImageStyle(n.ui.front,i.leftImg||i.frontImg||i.color):h.applyImageStyle(n.ui.front,i.rightImg||i.frontImg||i.color):f<0?h.applyImageStyle(n.ui.front,i.upImg||i.frontImg||i.color):h.applyImageStyle(n.ui.front,i.downImg||i.frontImg||i.color));var u={identifier:n.identifier,position:s,force:l,pressure:t.force||t.pressure||t.webkitForce||0,distance:d,angle:{radian:p,degree:a},instance:n,lockX:i.lockX,lockY:i.lockY};(u=n.computeDirection(u)).angle={radian:h.radians(180-a),degree:180-a},n.trigger("move",u),e.trigger("move "+n.id+":move",u)},d.prototype.processOnEnd=function(t){var e=this,i=e.options,o=e.manager.getIdentifier(t),n=e.nipples.get(o),r=e.manager.removeIdentifier(n.identifier);n&&(i.dataOnly||n.hide(function(){"dynamic"===i.mode&&(n.trigger("removed",n),e.trigger("removed "+n.id+":removed",n),e.manager.trigger("removed "+n.id+":removed",n),n.destroy())}),clearInterval(e.pressureIntervals[n.identifier]),n.resetDirection(),n.trigger("end",n),e.trigger("end "+n.id+":end",n),0<=e.ids.indexOf(n.identifier)&&e.ids.splice(e.ids.indexOf(n.identifier),1),0<=e.actives.indexOf(n)&&e.actives.splice(e.actives.indexOf(n),1),/(semi|static)/.test(i.mode)?e.idles.push(n):0<=e.nipples.indexOf(n)&&e.nipples.splice(e.nipples.indexOf(n),1),e.manager.unbindDocument(),/(semi|static)/.test(i.mode)&&(e.manager.ids[r.id]=r.identifier))},d.prototype.onDestroyed=function(t,e){var i=this;0<=i.nipples.indexOf(e)&&i.nipples.splice(i.nipples.indexOf(e),1),0<=i.actives.indexOf(e)&&i.actives.splice(i.actives.indexOf(e),1),0<=i.idles.indexOf(e)&&i.idles.splice(i.idles.indexOf(e),1),0<=i.ids.indexOf(e.identifier)&&i.ids.splice(i.ids.indexOf(e.identifier),1),i.manager.removeIdentifier(e.identifier),i.manager.unbindDocument()},d.prototype.destroy=function(){var t=this;for(var e in t.unbindEvt(t.options.zone,"start"),t.nipples.forEach(function(t){t.destroy()}),t.pressureIntervals)t.pressureIntervals.hasOwnProperty(e)&&clearInterval(t.pressureIntervals[e]);t.trigger("destroyed",t.nipples),t.manager.unbindDocument(),t.off()},a.prototype=new s,(a.constructor=a).prototype.prepareCollections=function(){var t=this;t.collections.create=t.create.bind(t),t.collections.on=t.on.bind(t),t.collections.off=t.off.bind(t),t.collections.destroy=t.destroy.bind(t),t.collections.get=function(e){var i;return t.collections.every(function(t){return!(i=t.get(e))}),i}},a.prototype.create=function(t){return this.createCollection(t)},a.prototype.createCollection=function(t){var e=new d(this,t);return this.bindCollection(e),this.collections.push(e),e},a.prototype.bindCollection=function(t){var i,o=this,e=function(t,e){i=t.type+" "+e.id+":"+t.type,o.trigger(i,e)};t.on("destroyed",o.onDestroyed.bind(o)),t.on("shown hidden rested dir plain",e),t.on("dir:up dir:right dir:down dir:left",e),t.on("plain:up plain:right plain:down plain:left",e)},a.prototype.bindDocument=function(){this.binded||(this.bindEvt(document,"move").bindEvt(document,"end"),this.binded=!0)},a.prototype.unbindDocument=function(t){Object.keys(this.ids).length&&!0!==t||(this.unbindEvt(document,"move").unbindEvt(document,"end"),this.binded=!1)},a.prototype.getIdentifier=function(t){var e;return t?void 0===(e=void 0===t.identifier?t.pointerId:t.identifier)&&(e=this.latest||0):e=this.index,void 0===this.ids[e]&&(this.ids[e]=this.index,this.index+=1),this.latest=e,this.ids[e]},a.prototype.removeIdentifier=function(t){var e={};for(var i in this.ids)if(this.ids[i]===t){e.id=i,e.identifier=this.ids[i],delete this.ids[i];break}return e},a.prototype.onmove=function(t){return this.onAny("move",t),!1},a.prototype.onend=function(t){return this.onAny("end",t),!1},a.prototype.oncancel=function(t){return this.onAny("end",t),!1},a.prototype.onAny=function(t,e){var i,o=this,n="processOn"+t.charAt(0).toUpperCase()+t.slice(1);e=h.prepareEvent(e);return h.map(e,function(t){i=o.getIdentifier(t),h.map(o.collections,function(t,e,i){0<=i.ids.indexOf(e)&&(i[n](t),t._found_=!0)}.bind(null,t,i)),t._found_||o.removeIdentifier(i)}),!1},a.prototype.destroy=function(){var t=this;t.unbindDocument(!0),t.ids={},t.index=0,t.collections.forEach(function(t){t.destroy()}),t.off()},a.prototype.onDestroyed=function(t,e){if(this.collections.indexOf(e)<0)return!1;this.collections.splice(this.collections.indexOf(e),1)};var l=new a;return{create:function(t){return l.create(t)},factory:l}});